import { types } from 'mobx-state-tree';
import { Card } from './Card';
import { Card as CardType } from '../types/cardTypes';
import { generateCardDescription } from '../utils/cardGenerator';

export const CardEditorStore = types
  .model('CardEditor', {
    currentCard: Card,
    autoGenerateDescription: types.boolean,
  })
  .actions(self => ({
    updateCurrentCard(card: Partial<CardType>) {
      self.currentCard = {
        ...self.currentCard,
        /* tslint:disable no-any unfortunately because MobX State Tree types are bad... */
        ...(card as any),
      };

      // If auto generate description is selected and the effects were changed, then we regenerate a card description
      if (card.effects && self.autoGenerateDescription) {
        self.currentCard.description = generateCardDescription(
          self.currentCard.category as any,
          self.currentCard.effects as any
        );
      }
    },
    toggleAutoGenerateDescription() {
      self.autoGenerateDescription = !self.autoGenerateDescription;

      // If auto generate description was selected then we generate a card description
      if (self.autoGenerateDescription) {
        self.currentCard.description = generateCardDescription(
          self.currentCard.category as any,
          self.currentCard.effects as any
        );
      }
    },
  }));

export type CardEditorStoreModelType = typeof CardEditorStore.Type;
